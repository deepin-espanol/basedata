/*
 * Forked - https://github.com/MoOx/salvattore
 *
 * Salvattore 1.0.5 by @rnmp and @ppold
 * https://github.com/rnmp/salvattore
 *
 */
!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("salvattore",[],t):e.salvattore=t()}(this,function(){return window.matchMedia||(window.matchMedia=function(){"use strict";var e=window.styleMedia||window.media;if(!e){var t=document.createElement("style"),n=document.getElementsByTagName("script")[0],r=null;t.type="text/css",t.id="matchmediajs-test",n.parentNode.insertBefore(t,n),r="getComputedStyle"in window&&window.getComputedStyle(t,null)||t.currentStyle,e={matchMedium:function(e){var n="@media "+e+"{ #matchmediajs-test { width: 1px; } }";return t.styleSheet?t.styleSheet.cssText=n:t.textContent=n,"1px"===r.width}}}return function(t){return{matches:e.matchMedium(t||"all"),media:t||"all"}}}()),function(){if(window.matchMedia&&window.matchMedia("all").addListener)return!1;var e=window.matchMedia,t=e("only all").matches,n=!1,r=0,a=[],i=function(){clearTimeout(r),r=setTimeout(function(){for(var t=0,n=a.length;n>t;t++){var r=a[t].mql,i=a[t].listeners||[],o=e(r.media).matches;if(o!==r.matches){r.matches=o;for(var c=0,l=i.length;l>c;c++)i[c].call(window,r)}}},30)};window.matchMedia=function(r){var o=e(r),c=[],l=0;return o.addListener=function(e){t&&(n||(n=!0,window.addEventListener("resize",i,!0)),0===l&&(l=a.push({mql:o,listeners:c})),c.push(e))},o.removeListener=function(e){for(var t=0,n=c.length;n>t;t++)c[t]===e&&c.splice(t,1)},o}}(),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),a=window.setTimeout(function(){t(n+r)},r);return e=n+r,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e,t){"use strict";var n={},r=[],a=function(e,t,n){e.dataset?e.dataset[t]=n:e.setAttribute("data-"+t,n)},i=function(e,t){return e.dataset?e.dataset[t]:e.setAttribute("data-"+t)};return n.obtain_grid_settings=function(t){var n,r,a=e.getComputedStyle(t,":before").getPropertyValue("content").slice(1,-1),i=a.match(/^\s*(\d+)(?:\s?\.(.+))?\s*$/);return i?(n=i[1],r=i[2],r=r?r.split("."):["column"]):(i=a.match(/^\s*\.(.+)\s+(\d+)\s*$/),r=i[1],(n=i[2])&&(n=n.split("."))),{numberOfColumns:n,columnClasses:r}},n.add_columns=function(e,r){for(var i=n.obtain_grid_settings(e),o=i.numberOfColumns,c=i.columnClasses,l=(new Array(+o),t.createDocumentFragment()),s=o;0!=s--;){var d=t.createElement("div");d.className=c.join(" "),l.appendChild(d)}e.appendChild(l),n.append_elements(e,Array.prototype.slice.call(r.children)),a(e,"columns",o)},n.remove_columns=function(n){var r=t.createRange();r.selectNodeContents(n);var i=Array.prototype.filter.call(r.extractContents().childNodes,function(t){return t instanceof e.HTMLElement}),o=i.length,c=i[0].childNodes.length,l=new Array(c*o);Array.prototype.forEach.call(i,function(e,t){Array.prototype.forEach.call(e.children,function(e,n){l[n*o+t]=e})});var s=t.createElement("div");return a(s,"columns",0),l.filter(function(e){return!!e}).forEach(function(e){s.appendChild(e)}),s},n.recreate_columns=function(t){e.requestAnimationFrame(function(){n.add_columns(t,n.remove_columns(t))})},n.media_query_change=function(e){e.matches&&Array.prototype.forEach.call(r,n.recreate_columns)},n.get_css_rules=function(e){var t;try{t=e.sheet.cssRules||e.sheet.rules}catch(e){return[]}return t||[]},n.get_stylesheets=function(){return Array.prototype.concat.call(Array.prototype.slice.call(t.querySelectorAll("style[type='text/css']")),Array.prototype.slice.call(t.querySelectorAll("link[rel='stylesheet']")))},n.media_rule_has_columns_selector=function(e){for(var t,n=e.length;n--;)if((t=e[n]).selectorText&&t.selectorText.match(/\[data-columns\](.*)::?before$/))return!0;return!1},n.scan_media_queries=function(){var t=[];e.matchMedia&&(n.get_stylesheets().forEach(function(r){Array.prototype.forEach.call(n.get_css_rules(r),function(r){r.media&&n.media_rule_has_columns_selector(r.cssRules)&&t.push(e.matchMedia(r.media.mediaText))})}),t.forEach(function(e){e.addListener(n.media_query_change)}))},n.next_element_column_index=function(e,t){var r,a,i,o,c=e.children,l=c.length,s=0,d=0,u=[];for(i=0;l>i;i++)u[i]=n.get_height_from_element(c[i]),Array.prototype.forEach.call(t[i].childNodes,function(e){u[i]+=n.get_height_from_element(e)});if((o=Math.min.apply(Math,u))>0)return u.indexOf(o);for(i=0;l>i;i++)r=c[i],a=r.children.length+(t[i].children||t[i].childNodes).length,0===s&&(s=a),s>a&&(d=i,s=a);return d},n.create_list_of_fragments=function(e){for(var n=new Array(e),r=0;r!==e;)n[r]=t.createDocumentFragment(),r++;return n},n.append_elements=function(e,r){var a=e.children,i=a.length,o=n.create_list_of_fragments(i),c=t.createElement("div");c.className=n.obtain_grid_settings(e).columnClasses.join(" "),c.appendChild(n.create_fragment(r)),e.appendChild(c),n.save_elements_height(r),e.removeChild(c),r.forEach(function(t){var r=n.next_element_column_index(e,o);o[r].appendChild(t)}),Array.prototype.forEach.call(a,function(e,t){e.appendChild(o[t])})},n.prepend_elements=function(e,r){var a=e.children,i=a.length,o=n.create_list_of_fragments(i),c=i-1;r.forEach(function(e){var t=o[c];t.insertBefore(e,t.firstChild),0===c?c=i-1:c--}),Array.prototype.forEach.call(a,function(e,t){e.insertBefore(o[t],e.firstChild)});for(var l=t.createDocumentFragment(),s=r.length%i;0!=s--;)l.appendChild(e.lastChild);e.insertBefore(l,e.firstChild)},n.register_grid=function(i){if("none"!==e.getComputedStyle(i).display){var o=t.createRange();o.selectNodeContents(i);var c=t.createElement("div");c.appendChild(o.extractContents()),a(c,"columns",0),n.add_columns(i,c),r.push(i)}},n.create_fragment=function(e){var n=t.createDocumentFragment();return Array.prototype.forEach.call(e,function(e){n.appendChild(e)}),n},n.get_height_from_element=function(e){var t=e.getBoundingClientRect().height;if(!t){var n=i(e,"salvatorreHeight");n&&(t=parseInt(n,10))}return t},n.save_elements_height=function(e){Array.prototype.forEach.call(e,function(e){a(e,"salvatorreHeight",e.getBoundingClientRect().height)})},n.init=function(){var e=t.createElement("style");e.innerHTML="[data-columns]::before{display:block;visibility:hidden;position:absolute;font-size:1px;}",t.head.appendChild(e);var r=t.querySelectorAll("[data-columns]");Array.prototype.forEach.call(r,n.register_grid),n.scan_media_queries()},n.init(),{append_elements:n.append_elements,prepend_elements:n.prepend_elements,register_grid:n.register_grid}}(window,window.document)});
